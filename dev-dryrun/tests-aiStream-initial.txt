  console.log
    [DB] test sqlite storage = :memory:

      at log (src/config/database.js:118:13)

  console.debug
    [authMiddleware][TEST] Authenticated user: userId: 2 companyId: 3

      at debug (src/middleware/authMiddleware.js:56:15)

  console.debug
    [authMiddleware][TEST] Authenticated user: userId: 2 companyId: 3

      at debug (src/middleware/authMiddleware.js:56:15)

  console.debug
    [authMiddleware][TEST] Authenticated user: userId: 2 companyId: 3

      at debug (src/middleware/authMiddleware.js:56:15)

  console.info
    [2026-01-11T15:58:03.335Z] [INFO] HTTP request {"meta":{"method":"post","path":"/api/ai/read/assistant/stream","ip":"127.0.0.1","userAgent":"","statusCode":200,"durationMs":12.94,"requestId":"86b69e57-1e76-402c-a552-cbedfab40377","userId":2,"companyId":3}}

      at method (src/lib/logger/index.js:217:3)

FAIL tests/routes/aiAssistantStream.test.js
  AI Assistant Stream API
    ✕ streams chunks with requestId and done event (23 ms)

  ● AI Assistant Stream API › streams chunks with requestId and done event

    expect(received).toContain(expected) // indexOf

    Expected substring: "event: chunk"
    Received string:    "event: error
    data: {\"errorCode\":\"AI_STREAM_ERROR\",\"message\":\"Cannot read properties of undefined (reading 'push')\",\"requestId\":\"86b69e57-1e76-402c-a552-cbedfab40377\"}·
    event: done
    data: {\"requestId\":\"86b69e57-1e76-402c-a552-cbedfab40377\"}·
    "

      42 |     expect(res.res.statusCode).toBe(200);
      43 |     expect(typeof res.body).toBe('string');
    > 44 |     expect(res.body).toContain('event: chunk');
         |                      ^
      45 |     expect(res.body).toContain('event: done');
      46 |     expect(res.body).toMatch(/requestId/);
      47 |   });

      at Object.toContain (tests/routes/aiAssistantStream.test.js:44:22)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
Snapshots:   0 total
Time:        1.157 s
Ran all test suites matching /tests\/routes\/aiAssistantStream.test.js/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
